(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      9835,        297]
NotebookOptionsPosition[      8568,        267]
NotebookOutlinePosition[      8994,        283]
CellTagsIndexPosition[      8951,        280]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["7 Optimal Execution with Continuous Trading II", "Chapter",
 CellChangeTimes->{{3.8236562263740196`*^9, 
  3.8236562409841003`*^9}},ExpressionUUID->"1245a78f-16d2-423f-bc44-\
947e8a52123a"],

Cell["7.2 Optimal Acquisition with a Price Limiter", "Section",
 CellChangeTimes->{{3.8236563507764993`*^9, 
  3.823656363880253*^9}},ExpressionUUID->"fc61f593-4034-4968-a510-\
4e345af681fc"],

Cell[CellGroupData[{

Cell["7.3 Incorporating Order Flow", "Section",
 CellChangeTimes->{{3.823659651593273*^9, 
  3.8236596662382526`*^9}},ExpressionUUID->"b0b3b84f-17fe-446e-8954-\
5c719fea6e9e"],

Cell[CellGroupData[{

Cell["Simulation params", "Subsubsection",
 CellChangeTimes->{{3.823661861823583*^9, 
  3.8236618705216074`*^9}},ExpressionUUID->"88d006e7-d94b-4098-b1cc-\
748c7218b50f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"T", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k", " ", "=", " ", 
   SuperscriptBox["10", 
    RowBox[{"-", "3"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", " ", "=", " ", 
   SuperscriptBox["10", 
    RowBox[{"-", "4"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Lambda]", "=", "1000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "2"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Kappa]", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Eta]0", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Gamma]", ":=", 
   SqrtBox[
    FractionBox["\[Phi]", "k"]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Alpha]", "=", "100"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Zeta]", ":=", 
   RowBox[{"N", "@", 
    FractionBox[
     RowBox[{"\[Alpha]", "-", 
      RowBox[{
       FractionBox["1", "2"], "b"}], "+", 
      SqrtBox[
       RowBox[{"k", "*", "\[Phi]"}]]}], 
     RowBox[{"\[Alpha]", "-", 
      RowBox[{
       FractionBox["1", "2"], "b"}], "-", 
      SqrtBox[
       RowBox[{"k", "*", "\[Phi]"}]]}]]}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8236618723659763`*^9, 3.823661973582205*^9}, {
  3.823662015104919*^9, 3.8236620619070807`*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"4243cf51-1223-41d6-88b3-e072f9e8e8aa"],

Cell[BoxData[
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.823661018557556*^9, 3.823661026612554*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"29ee4ddc-5ba9-45e4-b356-62c112476b0d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"h", "[", 
     RowBox[{"t_", ",", "\[Mu]_", ",", "q_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"h0", "[", 
      RowBox[{"t", ",", "\[Mu]"}], "]"}], "+", 
     RowBox[{"q", "*", 
      RowBox[{"h1", "[", 
       RowBox[{"t", ",", "\[Mu]"}], "]"}]}], "+", 
     RowBox[{
      SuperscriptBox["q", "2"], "*", 
      RowBox[{"h2", "[", 
       RowBox[{"t", ",", "\[Mu]"}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"h0", "[", 
    RowBox[{
     RowBox[{"t_", "/;", 
      RowBox[{"t", "\[Equal]", "T"}]}], ",", "\[Mu]_"}], "]"}], ":=", " ", 
   "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"h0", "[", 
    RowBox[{"t_", ",", "\[Mu]_"}], "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"\[Chi]", "[", "t", "]"}], "-", 
    RowBox[{
     FractionBox["1", "2"], "b"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Chi]", "[", "t_", "]"}], ":=", 
    RowBox[{
     SqrtBox[
      RowBox[{"k", "*", "\[Phi]"}]], "*", 
     FractionBox[
      RowBox[{"1", "+", 
       RowBox[{"\[Zeta]", "*", 
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"2", "*", "\[Gamma]", "*", 
          RowBox[{"(", 
           RowBox[{"T", "-", "t"}], ")"}]}]]}]}], 
      RowBox[{"1", "-", 
       RowBox[{"\[Zeta]", "*", 
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{"2", "*", "\[Gamma]", "*", 
          RowBox[{"(", 
           RowBox[{"T", "-", "t"}], ")"}]}]]}]}]]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"h1", "[", 
    RowBox[{
     RowBox[{"t_", "/;", 
      RowBox[{"t", "\[Equal]", "T"}]}], ",", "\[Mu]_"}], "]"}], ":=", " ", 
   "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"h1", "[", 
     RowBox[{"t_", ",", "\[Mu]_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"l0", "[", "t", "]"}], "+", 
     RowBox[{"\[Mu]", "*", 
      RowBox[{"l1", "[", "t", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"l1", "[", "t_", "]"}], ":=", 
     RowBox[{"b", "*", 
      RowBox[{
       SubsuperscriptBox["\[Integral]", "t", "T"], 
       RowBox[{
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{
          RowBox[{"-", "\[Kappa]"}], "*", 
          RowBox[{"(", 
           RowBox[{"s", "-", "t"}], ")"}]}]], 
        SuperscriptBox["\[ExponentialE]", 
         RowBox[{
          FractionBox["1", "k"], "*", 
          RowBox[{
           SubsuperscriptBox["\[Integral]", "t", "s"], 
           RowBox[{
            RowBox[{"\[Chi]", "[", "u", "]"}], 
            RowBox[{"\[DifferentialD]", "u"}]}]}]}]], 
        RowBox[{"\[DifferentialD]", "s"}]}]}]}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"l1", "[", "t_", "]"}], ":=", 
   RowBox[{"b", "*", 
    RowBox[{"l1bar", "[", 
     RowBox[{"T", "-", "t"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"l1bar", "[", "\[Tau]_", "]"}], ":=", 
   RowBox[{
    FractionBox["1", 
     RowBox[{
      RowBox[{"\[Zeta]", " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[Gamma]", " ", "\[Tau]"}]]}], "-", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[Gamma]"}], " ", "\[Tau]"}]]}]], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[Gamma]", " ", "\[Tau]"}]], "*", 
       FractionBox[
        RowBox[{"1", "-", 
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{"\[Kappa]", "+", "\[Gamma]"}], ")"}]}], "*", 
           "\[Tau]"}]]}], 
        RowBox[{"\[Kappa]", "+", "\[Gamma]"}]], "*", "\[Zeta]"}], "-", 
      RowBox[{
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{
         RowBox[{"-", "\[Gamma]"}], " ", "\[Tau]"}]], "*", 
       FractionBox[
        RowBox[{"1", "-", 
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{"\[Kappa]", "-", "\[Gamma]"}], ")"}]}], "*", 
           "\[Tau]"}]]}], 
        RowBox[{"\[Kappa]", "-", "\[Gamma]"}]]}]}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"h2", "[", 
    RowBox[{
     RowBox[{"t_", "/;", 
      RowBox[{"t", "\[Equal]", "T"}]}], ",", "\[Mu]_"}], "]"}], ":=", " ", 
   RowBox[{"-", "\[Alpha]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.823660599897107*^9, 3.8236606613646235`*^9}, {
   3.8236608490717936`*^9, 3.823660855631581*^9}, {3.8236608955008144`*^9, 
   3.823660921536729*^9}, {3.8236609558268385`*^9, 3.8236613189813166`*^9}, {
   3.8236613854884*^9, 3.8236616098187943`*^9}, 3.8236620135871396`*^9, {
   3.8236620734591665`*^9, 3.823662076777503*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"35d1b137-416c-4e38-b91a-eda60128074b"],

Cell[CellGroupData[{

Cell[BoxData["\[Phi]"], "Input",
 CellLabel->"In[47]:=",ExpressionUUID->"d5356e34-c0a9-4dfc-b19b-00dd4ecf5056"],

Cell[BoxData[
 FractionBox["1", "1000"]], "Output",
 CellChangeTimes->{3.8236610141471634`*^9},
 CellLabel->"Out[47]=",ExpressionUUID->"c95d4e9a-4326-4a39-91d5-fa412155148a"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1152., 585.6},
WindowMargins->{{Automatic, 955.5}, {Automatic, -5.3999999999999995`}},
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 7, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"4ab3eaa4-c5c2-4809-a6ef-7074ff942fc1"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 195, 3, 69, "Chapter",ExpressionUUID->"1245a78f-16d2-423f-bc44-947e8a52123a"],
Cell[778, 27, 191, 3, 67, "Section",ExpressionUUID->"fc61f593-4034-4968-a510-4e345af681fc"],
Cell[CellGroupData[{
Cell[994, 34, 175, 3, 53, "Section",ExpressionUUID->"b0b3b84f-17fe-446e-8954-5c719fea6e9e"],
Cell[CellGroupData[{
Cell[1194, 41, 170, 3, 45, "Subsubsection",ExpressionUUID->"88d006e7-d94b-4098-b1cc-748c7218b50f"],
Cell[1367, 46, 1616, 48, 322, "Input",ExpressionUUID->"4243cf51-1223-41d6-88b3-e072f9e8e8aa"],
Cell[2986, 96, 218, 3, 28, "Input",ExpressionUUID->"29ee4ddc-5ba9-45e4-b356-62c112476b0d"],
Cell[3207, 101, 4996, 150, 376, "Input",ExpressionUUID->"35d1b137-416c-4e38-b91a-eda60128074b"],
Cell[CellGroupData[{
Cell[8228, 255, 111, 1, 28, "Input",ExpressionUUID->"d5356e34-c0a9-4dfc-b19b-00dd4ecf5056"],
Cell[8342, 258, 174, 3, 48, "Output",ExpressionUUID->"c95d4e9a-4326-4a39-91d5-fa412155148a"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

